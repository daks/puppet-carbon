#!/etc/init/carbon-aggregator.conf
description	"Carbon aggregator server"
 
start on filesystem or runlevel [2345]
stop on runlevel [!2345]
 
env CARBON_AGGREGATOR=/opt/graphite/bin/carbon-aggregator.py
env PIDFILE=/opt/graphite/storage/carbon-aggregator-a.pid

expect daemon
kill timeout 20

umask 022
respawn
 
pre-start script
    test -d /opt/graphite || { stop; exit 0; }
end script
 
pre-stop script
  $CARBON_AGGREGATOR --pidfile=$PIDFILE stop

  # don't consider this service stopped until the PID gets removed
  #
  while [ -e $PIDFILE ]; do sleep 1 ; done
  exit 0
end script

chdir /opt/graphite
 
exec $CARBON_AGGREGATOR --pidfile=$PIDFILE start
